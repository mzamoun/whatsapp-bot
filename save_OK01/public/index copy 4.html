<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WhatsApp Bot Control</title>
<style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 0; }
    header { background: #007bff; color: white; padding: 1rem; text-align: center; }
    main { padding: 1rem; }
    button { margin: 0.5rem; padding: 0.5rem 1rem; font-size: 1rem; cursor: pointer; }
    #logs { background: #1e1e1e; color: #0f0; padding: 1rem; height: 300px; overflow-y: auto; white-space: pre-line; font-family: monospace; }
    #groups { margin-top: 1rem; }
    label { display:block; margin-top: 0.5rem; }
</style>
</head>
<body>

<header>
    <h1>WhatsApp Bot Control</h1>
    <div id="status">[STATUS] Déconnecté</div>
</header>

<main>
    <button id="startBot">Démarrer Bot</button>
    <button id="listGroups">Lister Groupes</button>
    <button id="logoutBot">Déconnecter Bot</button>

    <div id="scanSection">
        <label for="groupJid">JID du groupe :</label>
        <input type="text" id="groupJid" placeholder="Ex: 12345-678@g.us">
        <label for="startDate">Date de départ :</label>
        <input type="datetime-local" id="startDate">
        <button id="scanGroup">Scanner Groupe</button>
    </div>

    <div id="groups"></div>

    <h3>Logs :</h3>
    <div id="logs"></div>
</main>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();

    const logsDiv = document.getElementById('logs');
    const statusDiv = document.getElementById('status');
    const groupsDiv = document.getElementById('groups');

    function addLog(msg) {
        logsDiv.textContent += msg + "\n";
        logsDiv.scrollTop = logsDiv.scrollHeight;
    }

    socket.on('connect', () => addLog("[SOCKET] Connecté au serveur"));
    socket.on('disconnect', () => addLog("[SOCKET] Déconnecté du serveur"));

    socket.on('log', (msg) => addLog(msg));
    socket.on('status', ({ message, status }) => {
        statusDiv.textContent = `[STATUS] ${message}`;
        addLog(`[STATUS] ${message}`);
    });

    socket.on('groups-list', (groups) => {
        groupsDiv.innerHTML = "<h4>Groupes :</h4>";
        if (groups.length === 0) {
            groupsDiv.innerHTML += "<p>Aucun groupe trouvé</p>";
        } else {
            const ul = document.createElement('ul');
            groups.forEach(g => {
                const li = document.createElement('li');
                li.textContent = `${g.name} (${g.jid})`;
                ul.appendChild(li);
            });
            groupsDiv.appendChild(ul);
        }
    });

    document.getElementById('startBot').addEventListener('click', () => {
        addLog("[ACTION] Démarrage du bot...");
        socket.emit('start-bot');
    });

    document.getElementById('listGroups').addEventListener('click', () => {
        addLog("[ACTION] Liste des groupes...");
        socket.emit('list-groups');
    });

    document.getElementById('logoutBot').addEventListener('click', () => {
        addLog("[ACTION] Déconnexion du bot...");
        socket.emit('logout-bot');
    });

    document.getElementById('scanGroup').addEventListener('click', () => {
        const jid = document.getElementById('groupJid').value.trim();
        const startDate = document.getElementById('startDate').value;
        if (!jid || !startDate) {
            alert("Veuillez renseigner le JID et la date de départ !");
            return;
        }
        addLog(`[ACTION] Scan du groupe ${jid} depuis ${startDate}...`);
        socket.emit('scan-group', { jid, startDate });
    });
</script>

</body>
</html>
